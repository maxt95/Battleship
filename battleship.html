<html>
<head>
<style>
	body {
		background-color: #BFBFBF;
	}
	table {
		text-align: center;
		width: 60%;
		height: 90%;
		background-color: #1F4788;
	}
	table, td {
		border: 1px solid black;

	}
	td {
		background-color: #89C4F4;
	}
	td:hover {
		background-color: #4B77BE;
	}
	.left-panel {

		float: left;
		height: 100%;
		width: 20%;
		display: inline-block;
		font-size: 2em;
		
	}
	.right-panel {
		float: right;
		width: 20%;
		height: 100%;
		display: inline-block;
		font-size: 2em;
		text-align: center;

		
	}
	.center-panel {
		width: 60%;
		display: inline-block;
		
	}
	.gamescreen {
		
		font-family: monospace;
	}
</style>
<script>
	var score = "";
	function createTable() {
		var table = document.createElement('table');
		table.id = "battleshipTable";
		for (var i = 1; i < 11; i++){
		    var tr = document.createElement('tr');   

		    var td1 = document.createElement('td');
		    var td2 = document.createElement('td');
		    var td3 = document.createElement('td');
		    var td4 = document.createElement('td');
		    var td5 = document.createElement('td');
		    var td6 = document.createElement('td');
		    var td7 = document.createElement('td');
		    var td8 = document.createElement('td');
		    var td9 = document.createElement('td');
		    var td10 = document.createElement('td');
		    var text1 = document.createTextNode('');
		    var text2 = document.createTextNode('');

		    tr.appendChild(td1);
		    tr.appendChild(td2);
		    tr.appendChild(td3);
		    tr.appendChild(td4);
		    tr.appendChild(td5);
		    tr.appendChild(td6);
		    tr.appendChild(td7);
		    tr.appendChild(td8);
		    tr.appendChild(td9);
		    tr.appendChild(td10);

		    table.appendChild(tr);
		}
		document.body.appendChild(table);

	}
	function tableClick() {
		var table = document.getElementById("battleshipTable");
		if (table != null) {
		    for (var i = 0; i < table.rows.length; i++) {
		        for (var j = 0; j < table.rows[i].cells.length; j++)

		        	table.rows[i].cells[j].onclick = function () {
		            tableText(this, i, j);
		            alert('My position in table is: '+this.cellIndex+'x'+this.parentNode.rowIndex);
		            fire(this.cellIndex, this.parentNode.rowIndex);
		        };
		    }
		}

		
	}
	function tableText(tableCell,i, j) {
		    var x = document.getElementById("battleshipTable").getElementsByTagName("td");
		    tableCell.style.backgroundColor = "red";
		    
		}

	function fire(x, y) {
		var xmlhttp;
		xmlhttp = new XMLHttpRequest();
		xmlhttp.open("POST", "server.php", true);
		xmlhttp.onreadystatechange = function() {
			if(xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				alert(JSON.parse(xmlhttp.responseText));
			}
		};

		var cook = readCookie('username');
		var x = x;
		var y = y;

		var array = [x,y,cook];
		xmlhttp.send(JSON.stringify(array))
	}
	function getScores() {
		var xmlhttp;
		
	    window.onload = function first() {
	        xmlhttp = new XMLHttpRequest();
	        xmlhttp.open("POST", "getScores.php", true);
	        xmlhttp.onreadystatechange = function() {
	            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
	                score = JSON.parse(xmlhttp.responseText);
	                alert(score +" score");
	                document.getElementById("userScore").innerHTML = score;
	            }
	            
	        };
	        
	        var cook = readCookie('username');
	        alert(cook + "cookie username")
	        xmlhttp.send(JSON.stringify(cook));
	        
	    };
	    
	 	
	}
	function getOtherScores(player) {
		var xmlhttp;
		var ply = player;
	    window.onload = function first() {
	        xmlhttp = new XMLHttpRequest();
	        xmlhttp.open("POST", "getScores.php", true);
	        xmlhttp.onreadystatechange = function() {
	            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
	                score = JSON.parse(xmlhttp.responseText);
	                
	                document.getElementById("playerscores").innerHTML = score;
	            }
	            
	        };
	        
	        alert(ply + "player");
	        xmlhttp.send(JSON.stringify(ply));
	        
	    };
	    
	 	
	}

	function getPlayers() {
		var player;
		var xmlhttp;

		xmlhttp = new XMLHttpRequest();
		
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var code = JSON.parse(xmlhttp.responseText);
                	var txt = "";
                	for (var key = 1; key < code.length;key++) {
                    	txt += code[key].concat(":<br></br>");
                    	if (key == 0) {
                        	
                    	}
                	}
	          
	                document.getElementById("playernames").innerHTML = txt;
	            }
		};
		xmlhttp.open("GET", "getInfo.php", true);
		xmlhttp.send();
		
	}

	function getOtherPlayers(player) {
		var player;
		var xmlhttp;

		xmlhttp = new XMLHttpRequest();
		var cook = readCookie('username');
		alert(cook);
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var code = JSON.parse(xmlhttp.responseText);
                	var txt = "";
                	for (var key = 1; key < code.length;key++) {
                		if(cook === code[key])
                		{
                			alert(code[key]);
                		}
                		else
                		{
                			txt += code[key].concat(":<br></br>");
	                    	if (key === 0) {
	                        	
	                    	}
                		}
                    	
                	}
	          
	                document.getElementById("playernames").innerHTML = txt;
	            }
		};
		xmlhttp.open("GET", "getInfo.php", true);
		xmlhttp.send();
		
	}

	function readCookie(name) {
		var nameEQ = name + "=";
		var ca = document.cookie.split(';');
		for(var i=0;i < ca.length;i++) {
			var c = ca[i];
			while (c.charAt(0)==' ') c = c.substring(1,c.length);
			if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
		}
	return null;
}

</script>
</head>
	<body>
		
		<div class="gamescreen">
		<div style="font-size: 50px; text-align: center;">
			NAXJO Battleship
		</div>
		<div class="left-panel" style="text-align: center;">

			<script>
				var x = readCookie('username');

				document.write(x);
			</script>'s Score:
			<div id="userScore">
				<script>
					var currentScore = getScores();
					document.write(currentScore);
				</script>
				<text id = "userScore"></text>
			</div>
		</div>
		
		
		<div class="center-panel">
			<script>
				createTable();
				tableClick();
			</script>
		</div>
		<div class="right-panel">
			<div id="playernames" style="display:block;">
				<script>
					var player = getOtherPlayers();
					document.write(player);
					
				</script>

				
			</div>
			<div id="playerscores" style="display:block;">
					<script>
						var player = getOtherPlayers();
						var score = getOtherScores(player);
						document.write(score);
					</script>
					t
					<BR>
					</BR>
			</div>
			
		</div>
	</body>
	<footer style="background-color: grey;">
	</footer>
</html>